<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Viewpoint Chat</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start; /* Align to top */
    min-height: 100vh;
  }

  #chat-container {
    width: 800px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    max-height: 90vh; /* Limit height to 90% of viewport */
  }

  #tabs {
    display: flex;
    background: #007bff;
    padding: 10px;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  .tab {
    flex: 1;
    padding: 10px;
    text-align: center;
    color: white;
    cursor: pointer;
    border-radius: 5px;
    margin: 0 5px;
    transition: background 0.3s;
  }

  .tab.active {
    background: rgba(255, 255, 255, 0.2);
  }

  #chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    border-bottom: 1px solid #eee;
    background: #fafafa;
  }

  .message {
    margin-bottom: 15px;
    max-width: 70%;
    padding: 10px 15px;
    border-radius: 10px;
    word-wrap: break-word;
  }

  .user-message {
    background: #007bff;
    color: white;
    margin-left: auto;
  }

  .ai-message {
    background: #e9ecef;
    color: #333;
    margin-right: auto;
  }

  #input-area {
    display: flex;
    padding: 10px;
    background: white;
    position: sticky;
    bottom: 0;
  }

  #user-input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-right: 10px;
  }

  #send-button {
    padding: 10px 20px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  #send-button:hover {
    background: #0056b3;
  }
</style>
</head>
<body>
  <div id="chat-container">
    <div id="tabs">
      <div class="tab active" data-tab="all">All</div>
      <div class="tab" data-tab="1">Perspective 1</div>
      <div class="tab" data-tab="2">Perspective 2</div>
      <div class="tab" data-tab="3">Perspective 3</div>
    </div>

    <div id="chat-messages"></div>

    <div id="input-area">
      <input type="text" id="user-input" placeholder="Type your message...">
      <button id="send-button">Send</button>
    </div>
  </div>

  <script>
    const chatMessages = document.getElementById("chat-messages");
    const userInput = document.getElementById("user-input");
    const sendButton = document.getElementById("send-button");
    const tabs = document.querySelectorAll(".tab");

    let activeTab = "all";
    let storedConversations = {};

    // Tab switching logic
    tabs.forEach(tab => {
      tab.addEventListener("click", function () {
        tabs.forEach(t => t.classList.remove("active"));
        this.classList.add("active");
        activeTab = this.getAttribute("data-tab");
        displayMessages();
      });
    });

    // Display messages for the active tab
    function displayMessages() {
      chatMessages.innerHTML = "";
      const messages = storedConversations[activeTab] || [];
      messages.forEach(msg => {
        addMessage(`You: ${msg.user}`, "user-message");
        addMessage(`AI: ${msg.ai}`, "ai-message");
      });
      chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to bottom
    }

    // Add a message to the chat
    function addMessage(content, className) {
      const messageBox = document.createElement("div");
      messageBox.className = `message ${className}`;
      messageBox.textContent = content;
      chatMessages.appendChild(messageBox);
    }

    // Send message to backend
    sendButton.addEventListener("click", () => {
      const message = userInput.value.trim();
      if (message) {
        fetch("/get_response", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            user_input: message,
            tab: activeTab
          })
        })
          .then(response => response.json())
          .then(data => {
            storedConversations = data.conversations;
            displayMessages();
            userInput.value = ""; // Clear input
          });
      }
    });

    // Allow pressing Enter to send messages
    userInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        sendButton.click();
      }
    });
  </script>
</body>
</html>